<!DOCTYPE html>
<html lang="en">
<head>
    <title>idk calculator</title>


    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.0/dist/css/bootstrap.min.css" rel="stylesheet" 
    integrity="sha384-KyZXEAg3QhqLMpG8r+8fhAXLRk2vvoC2f3B09zVXn8CA5QIVfZOJ3BCsw2P0p/We" 
    crossorigin="anonymous">

    <style>
        /* DO NOT MODIFY THE BELOW CSS STYLING */
    * {
        font-family: Verdana, Geneva, Tahoma, sans-serif;
    }

    /* YOU MAY MODIFY THIS */
    #grid {
        border: 1px solid grey;
        margin: auto;
        width: 400px;
        height: 400px;

    }


    /* YOU MAY MODIFY THIS */
    #message {
        font-size: 15px;
        height: 40px;
        background-color: black;
        color: white;
        text-align: right;
    }


    /* YOU MAY MODIFY THIS */
    #current-equation {
        font-size: 20px;
        height: 40px;
        background-color: black;
        color: white;
        text-align: right;
    }


    /* YOU MAY MODIFY THIS */
    .key {
        display: flex;
        border: 2px solid pink;
        font-size: 26px;
        background-color: yellow;
        width: 100px;
        text-align: center;
        height: 64px;
        justify-content: center;
        align-items: center;
        position: relative;
        left: 11px;

    }


    /* YOU MAY ADD MORE CSS STYLING ANYWHERE IN THIS FILE */
    body {
        background-image: linear-gradient(to right,rgb(9, 255, 255), blue);
        background-repeat: no-repeat;
        background-attachment: fixed;
        
    }

    .row {
        display: flex;
    }

    #enemyHP{
        width: 100%;
        background-color: lightgreen;
    }

    #myHP{
        width: 100%;
        background-color: lightgreen;
    }

    .progress{
        background-color: red;
    }

    #myDiv {
        height: 500px;
    }


    #attackButton {
        position: relative;
        bottom: 170px;
    }

    #hitsplats p{
        margin: auto;
        display:flex;
        justify-content: center;
        align-items: center;
        width: 40px;
        height: 40px;
        background-image: url("hitsplat.png");
        background-repeat: no-repeat;
        background-size: 100%;
        position: relative;
        top: 90px;
        z-index: 1;

    }
    #hitsplats {
        visibility: hidden;
    }

    #monster {
        height: 340px;
        width: 230px;
        background-image: url("verzik.png");
        background-repeat: no-repeat;
        background-size: 80%;
        position: relative;
        bottom: 260px;
        left: 30px;
        margin: auto;
        z-index: -1;
    }

    #player {
        background-image: url("scythehits/0002.png");
        background-size: 100%;
        height: 350px;
        width: 300px;
        background-repeat: no-repeat;
        position: relative;
        right: 260px;
        top: 15px;
        z-index: -2;
    }

    #hiddenImages{
        visibility: hidden;
        size:0px;
        height: 0px;
        width: 0px;
    };

    </style>

</head>
<body>
    <a href="Q4.html" style="font-size: large;">shopping list la</a>
    <br>
    <a href="Q2.html" style="font-size: large;">carousel example</a>
    <br>
    <a href="q3.html" style="font-size: large;">axios example</a>
    <p>calculator right below</p><br>
    
    <div id="myDiv" class="container-fluid">
        <div id="hiddenImages">
        </div>
        <p>There is 5t cooldown between each attack</p>
        <div class="row">
            <div class="col-2"></div>

            <div class="col-4">
                <div class="text-danger text-center" id="EHP">3250/3250</div>
                <div class="progress">
                    <div class="progress-bar progress-bar-success" id="enemyHP"></div>
                </div>

                <div id="hitsplats" class="text-info"><p>0</p><p>0</p><p>0</p></div>
                <div id="monster"></div>
            </div>




            <div class="col-4">
                <div id="player"></div>
            </div>

            <div class="col-1"></div>
        </div>

        <br>

        <div class="row">
            <div class="btn btn-danger w-50 mx-auto" id="attackButton">attack</div>
        </div>


    </div>
    <br>

    <p style="height: 200px;"></p>



    <script>


    var hiddenImagesElement = document.getElementById("hiddenImages"); 
    for (i=1; i<=11; i++){
        var frameNumber = i*2;
        if (frameNumber < 10){
            frameNumber = "0" + frameNumber;
        }
        var imgString = "<img src='scythehits/00" + frameNumber + ".png'>";
        hiddenImagesElement.innerHTML += imgString;


    }

        var cd = false;

        function getRndInteger(min, max) {
            return Math.floor(Math.random() * (max - min + 1) ) + min;
        }

        var attackElement = document.getElementById("attackButton");
        attackElement.addEventListener("click", attackFunction);

        function myTimeout(timeSleep, frameNumber, playerElement){
        setTimeout(function(){
            playerElement.style.backgroundImage = "url('scythehits/00" + frameNumber + ".png')";
            }, timeSleep);
        }

        function attackFunction(){

            if (cd){
                return;
            }

            cd = true;
            console.log("attack!!");
            var ehpBarElement = document.getElementById("enemyHP");
            var eHPElement = document.getElementById("EHP");

            var eHPString = eHPElement.innerHTML;
            var currentEHP = eHPString.split("/")[0];
            var maxEHP = eHPString.split("/")[1];

            console.log(currentEHP);
            console.log(maxEHP);

            var hit1 = getRndInteger(0,46);
            var hit2 = getRndInteger(0,23);
            var hit3 = getRndInteger(0,11);

            currentEHP -= hit1 + hit2 + hit3;

            if (currentEHP <= 0){
                currentEHP = 0;
            }

           

            var eHPPercent = ((currentEHP / maxEHP)*100).toFixed(0);
            

            var hitsplatsElement = document.getElementById("hitsplats");
            hitsplatsElement.innerHTML = "<p>" + hit1 + "</p>" + "<p>" + hit2 + "</p>" + "<p>" + hit3 + "</p>";
            
            console.log("change attack");
            var playerElement = document.getElementById("player");
            for (i=1; i<=11; i++){
                var frameNumber = i*2;
                if (frameNumber < 10){
                    frameNumber = "0" + frameNumber;
                }
                //console.log("url('scythehits/00" + frameNumber + ".png')")
                myTimeout(150*i, frameNumber, playerElement);




            }
            //document.getElementById("player").style.backgroundImage = 'url("attack.gif")';
            
            setTimeout(function(){
            document.getElementById("hitsplats").style.visibility = "visible";
            ehpBarElement.style.width = eHPPercent + "%";
            eHPElement.innerHTML = currentEHP + "/" + maxEHP;
        }, 800);
            

            setTimeout(function(){
                document.getElementById("player").style.backgroundImage = 'url("scythehits/0002.png")';
            },1500);
            
            setTimeout(function(){cd = false;}, 3000);
            
            setTimeout(function(){
            document.getElementById("hitsplats").style.visibility = "hidden";}, 2000);
            
        }
    </script>






<!----------------------------calculator------------------------------------------->

    <!-- Header 
         DO NOT REMOVE THIS ELEMENT
         YOU MAY ADD MORE CODE
    -->
    <h1 style="text-align: center;">
        Calculator noobs dont know how to calculate ah
    </h1>


    <!-- [START] Calculator Grid 
         DO NOT REMOVE THIS ELEMENT
         YOU MAY ADD MORE CODE
    -->
    <div id="grid" style="display: block;">

        <!-- Output Boxes -->
        <div id="output">

            <!-- 1st message box -->
            <div id="message">
                Welcome to Calculator!
            </div>

            <!-- 2nd message box 
                 Display the current equation
            -->
            <div id="current-equation">
            </div>
        </div>

        
        <!-- 1st row of key options -->
        <div class="row">
            <div class="key" style="width: 200px;">
                AC
            </div>
            <div class="key">
                DEL
            </div>
            <div class="key">
                /
            </div>
        </div>


        <!-- 2nd row of key options -->
        <div class="row">
            <div class="key">
                1
            </div>
            <div class="key">
                2
            </div>
            <div class="key">
                3
            </div>
            <div class="key">
                *
            </div>
        </div>


        <!-- 3rd row of key options -->
        <div class="row">
            <div class="key">
                4
            </div>
            <div class="key">
                5
            </div>
            <div class="key">
                6
            </div>
            <div class="key">
                +
            </div>
        </div>


        <!-- 4th row of key options -->
        <div class="row">
            <div class="key">
                7
            </div>
            <div class="key">
                8
            </div>
            <div class="key">
                9
            </div>
            <div class="key">
                -
            </div>
        </div>


        <!-- 5th row of key options -->
        <div class="row">
            <div class="key">
                .
            </div>
            <div class="key">
                0
            </div>
            <div class="key" style="width: 200px;">
                =
            </div>
        </div>


    </div><!-- [END] Calculator Grid -->
    <br><br><br>



    <script>
        function keyPressed(keyElement) {
        console.log("a key is pressed");

        var keyValue = keyElement.innerHTML.trim();
        var messageElement = document.getElementById("message");
        var messageString = messageElement.innerHTML.trim();


        var equationElement = document.getElementById("current-equation");
        var eqnString = equationElement.innerHTML.trim();



        console.log(messageString);

        console.log(keyValue);


        messageElement.innerHTML = "";
        messageString = "";
        



        switch (keyValue){
        case ("AC"):
            messageElement.innerHTML = "";
            equationElement.innerHTML = "";
            break;

        case ("DEL"):
            equationElement.innerHTML = eqnString.slice(0, -1);
            break;

        case ("="):
            if (eqnString === ""){
                messageElement.innerHTML = "Nothing to calculate"
                break;
            }
            if ("/*+-.".includes(eqnString.charAt(eqnString.length-1))){
                messageElement.innerHTML = "Invalid Input";
                break;
            }
            messageElement.innerHTML = "Calculation result is here"
            equationElement.innerHTML = eval(eqnString);
            break;
        case ("."):
            if (eqnString === ""){
                messageElement.innerHTML = "Invalid Input"
                break;
            }
            if ("0123456789".includes(eqnString.charAt(eqnString.length-1))){


                var isValid = true;

                for (i=eqnString.length-1; i>=0; i--){
                    if ("0123456789".includes(eqnString.charAt(i))){
                        continue;
                    }
                    else if ("/*+-".includes(eqnString.charAt(i))){
                        isValid = true;
                        break;
                    }
                    else if (eqnString.charAt(i) === "."){
                        isValid = false;
                        break;
                    }
                }

                if (isValid){
                    equationElement.innerHTML = eqnString + ".";
                    break;
                }
                else {
                    messageElement.innerHTML = "Invalid Input";
                    break;
                }
            }
            else {
                messageElement.innerHTML = "Invalid Input";
                break;
            }

        default:

            if ("/*+-".includes(keyValue)){
                if (eqnString === "" || eqnString.charAt(eqnString.length-1) === "."){
                    messageElement.innerHTML = "Invalid Input"
                    break;
                }

                if ("/*+-".includes(eqnString.charAt(eqnString.length-1))){
                    console.log(eqnString.charAt(eqnString.length-1));
                    equationElement.innerHTML = eqnString.slice(0,-1) + keyValue;
                    break;
                }  
            }

            if (eqnString.charAt(eqnString.length-1) === "0"){
                var is2ndValid = false;

                for (i=eqnString.length-1; i>=0; i--){
                    if ("123456789".includes(eqnString.charAt(i))){
                        is2ndValid = true;
                        break;
                    }
                    else if ("/*+-".includes(eqnString.charAt(i))){
                        is2ndValid = false;
                        break;
                    }
                    else if (eqnString.charAt(i) === "."){
                        is2ndValid = true;
                        break;
                    }
                }

                if (!is2ndValid){
                equationElement.innerHTML = eqnString.slice(0,-1) + keyValue;
                break; 
                }
                else{
                    equationElement.innerHTML += keyValue;
                    break;
                }
            }

            equationElement.innerHTML += keyValue;
        
        
    }

        
        
        


        console.log("finished key pressed function");
    }
    </script>

    <script>
        var keyElements = document.getElementsByClassName("key");

        for (keyElement of keyElements){
            keyElement.addEventListener("click", function(){
                keyPressed(this);
            });
        }
    </script>
    
</body>
</html>