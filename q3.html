<!DOCTYPE html>
<html>
<head>
    <title>Review - Question 3</title>

    <!-- DO NOT REMOVE THE BELOW LINE -->
    <script src="axios/axios.min.js"></script>

    
    <!-- DO NOT MODIFY THE BELOW INTERNAL CSS -->
    <style>
        .low {
            background-color: green;
            color: white;
        }

        .medium {
            background-color: yellow;
            color: black;
        }

        .high {
            background-color: orange;
            color: black
        }

        .lethal {
            background-color: red;
            color: white
        }

        h1 {
            text-align: center;
        }
    </style>
</head>

<body>


    <!-- Header 
         DO NOT MODIFY THIS HTML
    -->
    <div>
        <h1>COVID-19 Count</h1>
        <img src="https://cdn.discordapp.com/attachments/818102115058450474/887315665273368596/pipbw.gif" />
    </div>


    <!-- COVID risk color is shown here 
         DO NOT MODIFY the below <div>'s id and style.
    -->
    <div id="risk" style="width: 100px; height: 30px; margin: auto;">

    </div>

    <!-- COVID Statistics are shown here 
         DO NOT MODIFY the below <div>'s id.
    -->
    <div id="stats">

    </div>


    


    <!-- JavaScript below -->
    <script>

        // DO NOT MODIFY THE BELOW LINE
        var input_country = prompt("Enter a country name (e.g. Singapore, USA, Brazil, etc.)")
        
        // DO NOT MODIFY THIS URL
        var url = "covidapi/count.json"

                

        // YOUR CODE GOES HERE
        // FEEL FREE TO WRITE YOUR OWN FUNCTIONS AS DEEMED NECESSARY

        input_country = input_country.charAt(0).toUpperCase() + input_country.slice(1).toLowerCase();

        if (input_country === "Usa"){
            input_country = "USA";
        }

        var query = input_country;


        axios.get(url, {
                params: {
                    query : query,
                }
        })

        /* stats
            {
                "total_cases": 4206253,
                "total_deaths": 141381,
                "total_recovered": 4020801,
                "active_cases": 44071,
                "population": 277078037
            }
        */
        .then(response =>  {
            var country = input_country;

            console.log(response.data);
            //console.log(response.data.statistics.Asia[input_country]);

            for (myRegion in response.data.statistics){
                //console.log(myRegion);
                if (country in response.data.statistics[myRegion]){
                    console.log(myRegion);
                    var foundRegion = myRegion;
                }
            }

            var stats = response.data.statistics[foundRegion][country];


            var totalCases = stats.total_cases;
            var totalDeaths = stats.total_deaths;
            var mortalityRate = totalDeaths / totalCases;
            mortalityRate = mortalityRate.toFixed(7);

            console.log(country);
            console.log(totalCases);
            console.log(totalDeaths);
            console.log(mortalityRate);


            var boxElement = document.getElementById("risk");

            if (mortalityRate < 0.01){
                boxElement.setAttribute("class", "low");
            }
            else if (0.01 <= mortalityRate < 0.02){
                boxElement.setAttribute("class", "meduim"); 
            }
            else if (0.02 <= mortalityRate < 0.03){
                boxElement.setAttribute("class", "high"); 
            }
            else {
                boxElement.setAttribute("class", "lethal"); 
            }


            var outputString = "<ul>";
            outputString += "<li>Country: " + country + "</li>";
            outputString += "<li>Total Cases: " + totalCases + "</li>";
            outputString += "<li>Total Deaths: " + totalDeaths + "</li>";
            outputString += "<li>Mortality Rate: " + mortalityRate + "</li>";
            outputString += "</ul>";

            var statsElement = document.getElementById("stats");
            statsElement.innerHTML = outputString;


        
        })
        .catch(error => {
            console.log(error.message)
            var statsElement = document.getElementById("stats");
            statsElement.innerHTML = "could not find country called " + query;

        });



        
    </script>

    
</body>
</html>
